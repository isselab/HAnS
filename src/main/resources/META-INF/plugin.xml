<!--
Copyright [2021] [Herman Jansson & Johan Martinson]

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->
<idea-plugin>
    <name>HAnS (Helping Annotate Software)</name>
    <vendor email="johan.t.martinson+HAnS@gmail.com" url="https://github.com/isselab/HAnS">Johan Martinson and Herman Jansson</vendor>

    <!-- please see https://www.jetbrains.org/intellij/sdk/docs/basics/getting_started/plugin_compatibility.html
         on how to target different products -->
    <depends>com.intellij.modules.java</depends>

    <!-- &begin[ColorSettingsPage] -->
    <extensions defaultExtensionNs="com.intellij">
        <colorSettingsPage implementation="se.isselab.HAnS.syntaxHighlighting.HansColorSettingsPage"/>
        <applicationConfigurable instance="se.isselab.HAnS.assetsManagement.HansAssetsManagementPage"/>
    </extensions>
    <!-- &end[ColorSettingsPage] -->

    <extensions defaultExtensionNs="com.intellij">
        <!-- &begin[HAnS::FeatureModel] -->
        <fileType name="Feature Model File" implementationClass="se.isselab.HAnS.featureModel.FeatureModelFileType"
                  fieldName="INSTANCE" language="FeatureModel" extensions="feature-model"/>
        <lang.parserDefinition language="FeatureModel"
                               implementationClass="se.isselab.HAnS.featureModel.FeatureModelParserDefinition"/>
        <!-- &end[HAnS::FeatureModel] -->

        <!-- &begin[HAnS::FileAnnotation] -->
        <fileType name="File Annotation File" implementationClass="se.isselab.HAnS.fileAnnotation.FileAnnotationFileType"
                  fieldName="INSTANCE" language="FileAnnotation" extensions="feature-to-file"/>
        <lang.parserDefinition language="FileAnnotation"
                                implementationClass="se.isselab.HAnS.fileAnnotation.FileAnnotationParserDefinition"/>
        <!-- &end[HAnS::FileAnnotation] -->

        <!-- &begin[HAnS::FolderAnnotation] -->
        <fileType name="Feature To Folder File" implementationClass="se.isselab.HAnS.folderAnnotation.FolderAnnotationFileType"
                  fieldName="INSTANCE" language="FolderAnnotation" extensions="feature-to-folder"/>
        <lang.parserDefinition language="FolderAnnotation"
                               implementationClass="se.isselab.HAnS.folderAnnotation.FolderAnnotationParserDefinition"/>
        <!-- &end[HAnS::FolderAnnotation] -->

        <!-- &begin[HAnS::CodeAnnotation] -->
        <fileType name="Code Annotation File" implementationClass="se.isselab.HAnS.codeAnnotation.CodeAnnotationFileType"
                  fieldName="INSTANCE" language="CodeAnnotations" extensions="code-annotation"/>
        <lang.parserDefinition language="CodeAnnotations"
                               implementationClass="se.isselab.HAnS.codeAnnotation.CodeAnnotationParserDefinition"/>
        <!-- &end[HAnS::CodeAnnotation] -->

        <!-- &begin[CodeCompletion] -->
        <completion.contributor language="any"
                                implementationClass="se.isselab.HAnS.codeCompletion.FileCompletionContributor"/>
        <!-- &end[CodeCompletion] -->

        <!-- &begin[SyntaxHighlighting] -->
        <!-- &begin[SyntaxHighlighting::FeatureModel] -->
        <lang.syntaxHighlighterFactory language="FeatureModel"
                                       implementationClass="se.isselab.HAnS.syntaxHighlighting.featureModel.FeatureModelSyntaxHighlighterFactory"/>
        <annotator language="FeatureModel"
                   implementationClass="se.isselab.HAnS.syntaxHighlighting.featureModel.FeatureModelAnnotator"/>
        <!-- &end[SyntaxHighlighting::FeatureModel] -->

        <!-- &begin[SyntaxHighlighting::FolderAnnotation] -->
        <lang.syntaxHighlighterFactory language="FolderAnnotation" implementationClass="se.isselab.HAnS.syntaxHighlighting.folderAnnotations.FolderAnnotationSyntaxHighlighterFactory"/>
        <annotator language="FolderAnnotation"
                   implementationClass="se.isselab.HAnS.syntaxHighlighting.folderAnnotations.FolderAnnotationAnnotator"/>
        <!-- &end[SyntaxHighlighting::FolderAnnotation] -->

        <!-- &begin[SyntaxHighlighting::FileAnnotation] -->
        <lang.syntaxHighlighterFactory language="FileAnnotation" implementationClass="se.isselab.HAnS.syntaxHighlighting.fileAnnotations.FileAnnotationSyntaxHighlighterFactory"/> <!-- &line[SyntaxHighlighting::FileAnnotation]-->
        <annotator language="FileAnnotation"
                   implementationClass="se.isselab.HAnS.syntaxHighlighting.fileAnnotations.FileAnnotationAnnotator"/>
        <!-- &end[SyntaxHighlighting::FileAnnotation] -->

        <!-- &begin[SyntaxHighlighting::CodeAnnotation] -->
        <lang.syntaxHighlighterFactory language="CodeAnnotations" implementationClass="se.isselab.HAnS.syntaxHighlighting.codeAnnotations.CodeAnnotationsSyntaxHighlighterFactory"/> <!-- &line[SyntaxHighlighting::CodeAnnotation]-->
        <annotator language="CodeAnnotations"
                   implementationClass="se.isselab.HAnS.syntaxHighlighting.codeAnnotations.CodeAnnotationAnnotator"/>
        <!-- &end[SyntaxHighlighting::CodeAnnotation] -->

        <additionalTextAttributes scheme="Darcula" file="colorSchemes/HAnSDarcula.xml"/>
        <additionalTextAttributes scheme="Default" file="colorSchemes/HAnSDefault.xml"/>
        <!-- &end[SyntaxHighlighting] -->

        <!-- &begin[Injection] -->
        <multiHostInjector implementation="se.isselab.HAnS.codeAnnotation.CodeAnnotationInjector"/>
        <!-- &end[Injection] -->

        <!-- &begin[FeatureView] -->
        <toolWindow id="Feature Model View" secondary="true" anchor="left"
                    factoryClass="se.isselab.HAnS.featureView.FeatureViewFactory"/>
        <!-- &end[FeatureView] -->

        <!-- &begin[Referencing] -->
        <psi.referenceContributor implementation="se.isselab.HAnS.referencing.FeatureReferenceContributor" language=""/>
        <lang.findUsagesProvider language="FeatureModel"
                                 implementationClass="se.isselab.HAnS.referencing.FeatureFindUsagesProvider"/>
        <useScopeEnlarger implementation="se.isselab.HAnS.FeatureAnnotationScopeEnlarger"/>
        <psi.referenceContributor implementation="se.isselab.HAnS.referencing.FileReferenceContributor" language=""/>
        <renameInputValidator implementation="se.isselab.HAnS.referencing.FeatureNameInputValidator"/>
        <!-- &end[Referencing] -->

        <!-- &begin[FileTemplate] -->
        <fileTemplateGroup implementation="se.isselab.HAnS.actions.newFile.EFAFileTemplateManager"/>
        <!-- &end[FileTemplate] -->
        <!-- &begin[LiveTemplate] -->
        <defaultLiveTemplates file="/liveTemplates/EFA.xml"/>
        <liveTemplateContext implementation="se.isselab.HAnS.codeCompletion.AnyContext" contextId="ANY"/>
        <liveTemplateContext implementation="se.isselab.HAnS.codeCompletion.CommentContext" contextId="COMMENT"/>
        <!-- &end[LiveTemplate] -->
        <postStartupActivity implementation="se.isselab.HAnS.assetsManagement.cloningAssets.CloneFileListener"/>
        <copyPastePreProcessor implementation="se.isselab.HAnS.assetsManagement.cloningAssets.CloneCopyPastePreProcessor"/>
        <editorNotificationProvider implementation="se.isselab.HAnS.assetsManagement.propagatingToAsset.PropagatingProvider"/>
    </extensions>
    <!--
    <applicationListeners>
        <listener class="se.isselab.HAnS.assetsManagement.propagatingToAsset.PropagatingService"
                  topic="com.intellij.openapi.fileEditor.FileEditorManagerListener"/>
    </applicationListeners>
    -->
    <actions>
        <action id="RenameFeature"
                class="se.isselab.HAnS.actions.RenameAction"
                text="Rename..."
                description="Rename feature">
            <add-to-group group-id="StructureViewPopupMenu" anchor="first"/>
        </action>
        <action id="AddFeature"
                class="se.isselab.HAnS.actions.AddAction"
                text="Add..." description="Add feature"
                icon="AllIcons.General.Add">
            <add-to-group group-id="StructureViewPopupMenu" anchor="after" relative-to-action="RenameFeature"/>
        </action>
        <action id="DeleteFeature"
                class="se.isselab.HAnS.actions.DeleteAction"
                text="Delete..."
                description="Delete feature"
                icon="AllIcons.General.Remove">
            <add-to-group group-id="StructureViewPopupMenu" anchor="after" relative-to-action="AddFeature"/>
        </action>

        <!-- &begin[NewFile] -->
        <action id="CreateNewFileAction"
                class="se.isselab.HAnS.actions.newFile.CreateNewFileAction" text="New EFA File"
                description="Create new feature mappings">
            <add-to-group group-id="NewGroup" anchor="before" relative-to-action="NewFile"/>
        </action>
        <!-- &end[NewFile] -->

        <action id="SurroundFeature" text="Surround with Feature Annotation" class="com.intellij.codeInsight.template.impl.actions.SurroundWithTemplateAction" use-shortcut-of="SurroundWithLiveTemplate" >
            <add-to-group
                    group-id="EditorPopupMenu" anchor="first" />
        </action>

        <action id="CloneAsset" text="Clone Asset" class="se.isselab.HAnS.actions.assetsManagement.CloneAsset">
            <add-to-group group-id="ProjectViewPopupMenu" anchor="first" />
            <add-to-group group-id="EditorPopupMenu" anchor="after" relative-to-action="SurroundFeature" />
        </action>

        <action id="PasteAsset" text="Paste Cloned Asset" class="se.isselab.HAnS.actions.assetsManagement.PasteClonedAsset">
            <add-to-group group-id="ProjectViewPopupMenu" anchor="first" />
            <add-to-group group-id="EditorPopupMenu" anchor="after" relative-to-action="CloneAsset" />
        </action>

    </actions>
</idea-plugin>